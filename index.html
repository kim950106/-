<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ì „ë¶í‘¸ë“œì»¤ë„¥íŠ¸</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/orioncactus/pretendard@v1.3.9/dist/web/static/pretendard.min.css" />
    <style>
        body { font-family: "Pretendard Variable", sans-serif; background-color: #F3F4F6; -webkit-tap-highlight-color: transparent; }
        /* ìŠ¤í¬ë¡¤ë°” ìˆ¨ê¹€ */
        .scrollbar-hide::-webkit-scrollbar { display: none; }
        .scrollbar-hide { -ms-overflow-style: none; scrollbar-width: none; }
        /* ì• ë‹ˆë©”ì´ì…˜ */
        .fade-in { animation: fadeIn 0.3s ease-in-out; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(5px); } to { opacity: 1; transform: translateY(0); } }
    </style>
</head>
<body class="text-gray-800 antialiased select-none">

    <!-- 0. ë¡œë”© ì˜¤ë²„ë ˆì´ (í™”ë©´ ì •ì¤‘ì•™ ê³ ì •) -->
    <div id="loadingOverlay" class="hidden fixed inset-0 z-[9999] bg-black/60 backdrop-blur-sm flex flex-col justify-center items-center">
        <div class="w-10 h-10 border-4 border-white border-t-orange-500 rounded-full animate-spin mb-4"></div>
        <p class="text-white font-bold text-lg">ì²˜ë¦¬ ì¤‘ì…ë‹ˆë‹¤...</p>
    </div>

    <!-- 1. ìƒë‹¨ í—¤ë” (ê³ ì •) -->
    <header class="fixed top-0 left-0 right-0 z-50 bg-white/95 backdrop-blur border-b border-gray-200 h-14 flex items-center justify-between px-4 shadow-sm">
        <div class="flex items-center gap-1 cursor-pointer" onclick="location.reload()">
            <span class="text-2xl">ğŸšš</span>
            <h1 class="text-lg font-extrabold text-gray-900 tracking-tight">ì „ë¶í‘¸ë“œì»¤ë„¥íŠ¸</h1>
        </div>
        <button onclick="openRegionModal()" class="flex items-center gap-1 px-3 py-1.5 bg-gray-100 rounded-full text-xs font-bold text-gray-600 hover:bg-gray-200 transition">
            <span id="headerRegion">ì „ë¶ ì „ì²´</span>
            <svg class="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path></svg>
        </button>
    </header>

    <!-- ë©”ì¸ ì»¨í…ì¸  ì˜ì—­ (í—¤ë”/í‘¸í„° ë†’ì´ë§Œí¼ ì—¬ë°± í™•ë³´) -->
    <div class="pt-16 pb-24 px-4 max-w-md mx-auto min-h-screen">
        
        <!-- === [íƒ­ 1] í™ˆ í™”ë©´ === -->
        <main id="homeView" class="fade-in">
            <!-- ë°°ë„ˆ ì„¹ì…˜ -->
            <div class="relative w-full h-48 rounded-2xl overflow-hidden shadow-md mb-6 bg-gray-200">
                <img src="https://images.unsplash.com/photo-1565123409695-7b5ef63a2efb?q=80&w=800&auto=format&fit=crop" 
                     class="w-full h-full object-cover brightness-75"
                     onerror="this.src='https://via.placeholder.com/800x400?text=Jeonbuk+Food+Truck'">
                <div class="absolute bottom-4 left-4 text-white">
                    <span class="bg-orange-600 text-[10px] font-bold px-2 py-1 rounded mb-1 inline-block">ê³µì‹ íŒŒíŠ¸ë„ˆ</span>
                    <h2 class="text-xl font-bold leading-tight">ë‹¹ì‹ ì´ ìˆëŠ” ê³³ìœ¼ë¡œ<br>ë‹¬ë ¤ê°‘ë‹ˆë‹¤.</h2>
                </div>
            </div>

            <!-- íŠ¸ëŸ­ ë¦¬ìŠ¤íŠ¸ ì„¹ì…˜ -->
            <div class="mb-8">
                <h3 class="text-lg font-bold text-gray-900 mb-3 flex items-center">
                    ğŸš› ìš°ë¦¬ë™ë„¤ í‘¸ë“œíŠ¸ëŸ­ <span class="ml-2 text-xs font-normal text-gray-500">í´ë¦­í•˜ì—¬ ìƒì„¸ì •ë³´ í™•ì¸</span>
                </h3>
                <div id="truckList" class="grid grid-cols-2 gap-3">
                    <div class="col-span-2 py-8 text-center text-gray-400 text-sm">ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</div>
                </div>
            </div>

            <!-- ê²¬ì  ë¬¸ì˜ ì„¹ì…˜ -->
            <div id="inquirySection" class="bg-white p-5 rounded-2xl shadow-sm border border-gray-200">
                <div class="mb-4 border-b border-gray-100 pb-2">
                    <h3 class="text-lg font-bold text-gray-900">ğŸ“ ê°„í¸ í–‰ì‚¬ ë¬¸ì˜</h3>
                    <p class="text-xs text-gray-500">ì›í•˜ëŠ” ì§€ì—­ê³¼ ì˜ˆì‚°ì„ ì•Œë ¤ì£¼ì„¸ìš”.</p>
                </div>
                
                <form id="quoteForm" class="space-y-3">
                    <input type="hidden" name="type" value="quote">
                    
                    <div class="space-y-1">
                        <label class="text-xs font-bold text-gray-500">ì§€ì—­ ë° íŠ¸ëŸ­ ì„ íƒ</label>
                        <div class="flex gap-2">
                            <select id="qRegion" class="w-1/3 bg-gray-50 border border-gray-200 rounded-lg p-2.5 text-sm outline-none" onchange="updateTruckSelect(this.value)">
                                <option value="ì „ì²´">ì „ì²´</option>
                                <option value="ì „ì£¼">ì „ì£¼</option><option value="êµ°ì‚°">êµ°ì‚°</option><option value="ìµì‚°">ìµì‚°</option><option value="ì •ì">ì •ì</option><option value="ë‚¨ì›">ë‚¨ì›</option><option value="ê¹€ì œ">ê¹€ì œ</option><option value="ì™„ì£¼">ì™„ì£¼</option><option value="ì§„ì•ˆ">ì§„ì•ˆ</option><option value="ë¬´ì£¼">ë¬´ì£¼</option><option value="ì¥ìˆ˜">ì¥ìˆ˜</option><option value="ì„ì‹¤">ì„ì‹¤</option><option value="ìˆœì°½">ìˆœì°½</option><option value="ê³ ì°½">ê³ ì°½</option><option value="ë¶€ì•ˆ">ë¶€ì•ˆ</option>
                            </select>
                            <select name="selectedTruck" id="qTruck" class="w-2/3 bg-gray-50 border border-gray-200 rounded-lg p-2.5 text-sm outline-none">
                                <option value="ìƒê´€ì—†ìŒ">íŠ¸ëŸ­ ìƒê´€ì—†ìŒ (ì¶”ì²œ)</option>
                            </select>
                        </div>
                    </div>

                    <div class="grid grid-cols-2 gap-2">
                        <input type="text" name="name" placeholder="ì‹ ì²­ìëª…" required class="bg-gray-50 border border-gray-200 rounded-lg p-3 text-sm outline-none focus:border-orange-500">
                        <input type="tel" name="phone" placeholder="ì—°ë½ì²˜" required class="bg-gray-50 border border-gray-200 rounded-lg p-3 text-sm outline-none focus:border-orange-500">
                    </div>
                    
                    <input type="email" name="clientEmail" placeholder="ì´ë©”ì¼ (ê³„ì•½ì„œ ìˆ˜ì‹ ìš©)" required class="w-full bg-gray-50 border border-gray-200 rounded-lg p-3 text-sm outline-none focus:border-orange-500">

                    <div class="grid grid-cols-2 gap-2">
                        <input type="date" name="date" required class="bg-gray-50 border border-gray-200 rounded-lg p-3 text-sm text-gray-500 outline-none">
                        <input type="text" name="budget" placeholder="ì˜ˆì‚° (ì˜ˆ: 50ë§Œì›)" class="bg-gray-50 border border-gray-200 rounded-lg p-3 text-sm outline-none">
                    </div>

                    <input type="text" name="location" placeholder="í–‰ì‚¬ ì¥ì†Œ ìƒì„¸ (ì£¼ì†Œ)" required class="w-full bg-gray-50 border border-gray-200 rounded-lg p-3 text-sm outline-none focus:border-orange-500">
                    <textarea name="details" rows="2" placeholder="ì¶”ê°€ ìš”ì²­ì‚¬í•­ (ë©”ë‰´, ì¸ì› ë“±)" class="w-full bg-gray-50 border border-gray-200 rounded-lg p-3 text-sm outline-none focus:border-orange-500"></textarea>
                    
                    <button type="submit" id="quoteBtn" class="w-full bg-orange-600 text-white font-bold py-3.5 rounded-xl shadow-lg active:scale-95 transition">ë¬¸ì˜ ì ‘ìˆ˜í•˜ê¸°</button>
                </form>
            </div>
        </main>

        <!-- === [íƒ­ 2] íŒŒíŠ¸ë„ˆ ë“±ë¡ í™”ë©´ === -->
        <main id="partnerView" class="hidden fade-in">
            <div class="text-center mb-6">
                <h2 class="text-2xl font-bold text-gray-900">íŒŒíŠ¸ë„ˆ ë“±ë¡</h2>
                <p class="text-sm text-gray-500">ì‚¬ì¥ë‹˜ê³¼ ìŠ¤íƒœí”„ë¥¼ ëª¨ì‹­ë‹ˆë‹¤.</p>
            </div>

            <form id="partnerForm" class="bg-white p-5 rounded-2xl shadow-sm border border-gray-200 space-y-4">
                <input type="hidden" name="type" value="partner">
                
                <!-- ê°€ì… ìœ í˜• ì„ íƒ -->
                <div class="grid grid-cols-2 gap-2 p-1 bg-gray-100 rounded-lg">
                    <label class="cursor-pointer">
                        <input type="radio" name="category" value="í‘¸ë“œíŠ¸ëŸ­" checked class="peer hidden" onchange="toggleForm('truck')">
                        <div class="py-2 text-center text-sm font-bold text-gray-500 rounded-md peer-checked:bg-white peer-checked:text-orange-600 peer-checked:shadow-sm transition">ğŸšš íŠ¸ëŸ­ ì‚¬ì¥ë‹˜</div>
                    </label>
                    <label class="cursor-pointer">
                        <input type="radio" name="category" value="ì¸ë ¥" class="peer hidden" onchange="toggleForm('staff')">
                        <div class="py-2 text-center text-sm font-bold text-gray-500 rounded-md peer-checked:bg-white peer-checked:text-blue-600 peer-checked:shadow-sm transition">ğŸ§‘â€ğŸ³ í˜„ì¥ ìŠ¤íƒœí”„</div>
                    </label>
                </div>

                <!-- ê°€ë³€ ì…ë ¥ í•„ë“œ -->
                <div class="space-y-3">
                    <div id="fieldTruckOnly">
                        <input type="text" id="truckName" placeholder="ìƒí˜¸ëª…" class="w-full bg-gray-50 border border-gray-200 p-3 rounded-lg text-sm outline-none mb-2">
                        <input type="text" id="truckOwner" placeholder="ëŒ€í‘œìëª…" class="w-full bg-gray-50 border border-gray-200 p-3 rounded-lg text-sm outline-none mb-2">
                        <input type="text" name="basicQuote" id="basicQuote" placeholder="ê¸°ë³¸ ê²¬ì  (ì˜ˆ: 100ì¸ë¶„ 80ë§Œì›ë¶€í„°)" class="w-full bg-gray-50 border border-gray-200 p-3 rounded-lg text-sm outline-none">
                    </div>
                    <div id="fieldStaffOnly" class="hidden space-y-2">
                        <input type="text" id="staffName" placeholder="ì„±í•¨ (ë³¸ëª…)" class="w-full bg-gray-50 border border-gray-200 p-3 rounded-lg text-sm outline-none">
                        <div class="flex gap-2">
                            <input type="number" id="staffAge" placeholder="ë‚˜ì´" class="w-1/3 bg-gray-50 border border-gray-200 p-3 rounded-lg text-sm outline-none">
                            <input type="text" id="staffDates" placeholder="ê·¼ë¬´ ê°€ëŠ¥ì¼ (ì˜ˆ: ì£¼ë§)" class="w-2/3 bg-gray-50 border border-gray-200 p-3 rounded-lg text-sm outline-none">
                        </div>
                    </div>

                    <div class="flex gap-2">
                        <input type="tel" name="phone" placeholder="ì—°ë½ì²˜" required class="w-1/2 bg-gray-50 border border-gray-200 p-3 rounded-lg text-sm outline-none">
                        <input type="email" name="email" placeholder="ì´ë©”ì¼ (í•„ìˆ˜)" required class="w-1/2 bg-gray-50 border border-gray-200 p-3 rounded-lg text-sm outline-none">
                    </div>

                    <select name="region" class="w-full bg-gray-50 border border-gray-200 p-3 rounded-lg text-sm outline-none text-gray-600">
                        <option value="">í™œë™ ì§€ì—­ ì„ íƒ</option>
                        <option value="ì „ì£¼">ì „ì£¼</option><option value="êµ°ì‚°">êµ°ì‚°</option><option value="ìµì‚°">ìµì‚°</option><option value="ì •ì">ì •ì</option><option value="ë‚¨ì›">ë‚¨ì›</option><option value="ê¹€ì œ">ê¹€ì œ</option><option value="ì™„ì£¼">ì™„ì£¼</option><option value="ì§„ì•ˆ">ì§„ì•ˆ</option><option value="ë¬´ì£¼">ë¬´ì£¼</option><option value="ì¥ìˆ˜">ì¥ìˆ˜</option><option value="ì„ì‹¤">ì„ì‹¤</option><option value="ìˆœì°½">ìˆœì°½</option><option value="ê³ ì°½">ê³ ì°½</option><option value="ë¶€ì•ˆ">ë¶€ì•ˆ</option>
                    </select>

                    <input type="text" name="menu" id="inputMenu" placeholder="ì£¼ìš” ë©”ë‰´" required class="w-full bg-gray-50 border border-gray-200 p-3 rounded-lg text-sm outline-none">
                    <textarea name="desc" rows="3" placeholder="ì†Œê°œê¸€" class="w-full bg-gray-50 border border-gray-200 p-3 rounded-lg text-sm outline-none"></textarea>
                </div>

                <!-- íŒŒì¼ ì—…ë¡œë“œ -->
                <div class="bg-gray-50 p-3 rounded-lg border border-gray-200 space-y-2">
                    <p class="text-xs font-bold text-gray-500 mb-1">ğŸ“· í•„ìˆ˜ ì„œë¥˜ ë° ì‚¬ì§„ ì²¨ë¶€</p>
                    <div id="divBiz" class="flex items-center justify-between">
                        <span class="text-xs text-gray-600">ì‚¬ì—…ìë“±ë¡ì¦</span>
                        <input type="file" id="fileBiz" class="text-[10px] text-gray-400 w-32">
                    </div>
                    <div class="flex items-center justify-between">
                        <span class="text-xs text-gray-600">ë³´ê±´ì¦</span>
                        <input type="file" id="fileHealth" class="text-[10px] text-gray-400 w-32">
                    </div>
                    <div class="flex items-center justify-between">
                        <span class="text-xs text-gray-600">ëŒ€í‘œ ì‚¬ì§„</span>
                        <input type="file" id="imgMain" class="text-[10px] text-gray-400 w-32">
                    </div>
                </div>

                <!-- ë™ì˜ ì²´í¬ -->
                <div class="flex items-center gap-2 p-2">
                    <input type="checkbox" required class="w-4 h-4 text-orange-600 accent-orange-600">
                    <span class="text-xs text-gray-500">(í•„ìˆ˜) ê°œì¸ì •ë³´ ìˆ˜ì§‘ ë° ì œê³µ ë™ì˜</span>
                </div>

                <button type="submit" id="partnerBtn" class="w-full bg-gray-900 text-white font-bold py-3.5 rounded-xl shadow-lg active:scale-95 transition">ë“±ë¡ ì‹ ì²­í•˜ê¸°</button>
            </form>
        </main>

    </div>

    <!-- 3. í•˜ë‹¨ íƒ­ë°” (ê³ ì •) -->
    <nav class="fixed bottom-0 left-0 right-0 bg-white border-t border-gray-200 h-16 flex justify-around items-center pb-safe z-40 max-w-md mx-auto">
        <button onclick="switchTab('home')" id="tabHome" class="flex flex-col items-center justify-center w-full h-full text-orange-600">
            <span class="text-xl mb-0.5">ğŸ </span>
            <span class="text-[10px] font-bold">í™ˆ/ë¬¸ì˜</span>
        </button>
        <button onclick="switchTab('partner')" id="tabPartner" class="flex flex-col items-center justify-center w-full h-full text-gray-400">
            <span class="text-xl mb-0.5">ğŸ“</span>
            <span class="text-[10px] font-bold">íŒŒíŠ¸ë„ˆ ë“±ë¡</span>
        </button>
    </nav>

    <!-- 4. ì§€ì—­ ì„ íƒ ëª¨ë‹¬ -->
    <div id="regionModal" class="hidden fixed inset-0 z-50 bg-black/60 backdrop-blur-sm flex items-center justify-center px-4">
        <div class="bg-white w-full max-w-xs rounded-2xl p-5 shadow-2xl">
            <div class="flex justify-between items-center mb-4">
                <h3 class="font-bold text-lg">ì§€ì—­ ì„ íƒ</h3>
                <button onclick="document.getElementById('regionModal').classList.add('hidden')" class="text-gray-400 hover:text-black">âœ•</button>
            </div>
            <div class="grid grid-cols-4 gap-2 text-sm text-center" id="regionGrid"></div>
        </div>
    </div>

    <!-- 5. ìƒì„¸ ë³´ê¸° ëª¨ë‹¬ -->
    <div id="detailModal" class="hidden fixed inset-0 z-[60] bg-black/80 backdrop-blur-sm flex items-center justify-center px-4">
        <div class="bg-white w-full max-w-sm rounded-3xl overflow-hidden shadow-2xl flex flex-col h-[70vh]">
            <!-- ì´ë¯¸ì§€ ì˜ì—­ -->
            <div class="h-2/5 bg-gray-200 relative">
                <img id="modalImg" class="w-full h-full object-cover">
                <button onclick="document.getElementById('detailModal').classList.add('hidden')" class="absolute top-3 right-3 bg-black/50 text-white p-1.5 rounded-full">âœ•</button>
            </div>
            <!-- í…ìŠ¤íŠ¸ ì˜ì—­ -->
            <div class="flex-1 p-6 overflow-y-auto pb-20">
                <span id="detailBadge" class="text-[10px] font-bold px-2 py-1 rounded bg-orange-100 text-orange-600 mb-2 inline-block"></span>
                <h3 id="detailName" class="text-2xl font-bold text-gray-900 mb-1"></h3>
                <p id="detailRegion" class="text-xs text-gray-500 mb-4"></p>
                
                <div id="subImages" class="flex gap-2 overflow-x-auto mb-4 scrollbar-hide"></div>

                <div class="bg-gray-50 p-4 rounded-xl mb-4 border border-gray-100">
                    <h4 class="text-xs font-bold text-gray-400 mb-1">ë©”ë‰´ / ì†Œê°œ</h4>
                    <p id="detailMenu" class="font-medium text-gray-800 text-sm"></p>
                </div>
                <p id="detailDesc" class="text-sm text-gray-600 leading-relaxed whitespace-pre-wrap"></p>
                
                <div id="quoteBox" class="hidden mt-4 bg-orange-50 p-4 rounded-xl border border-orange-100">
                    <h4 class="text-xs font-bold text-orange-600 mb-1">ğŸ’° ê¸°ë³¸ ê²¬ì </h4>
                    <p id="quoteText" class="text-sm font-bold text-gray-800"></p>
                </div>
            </div>
            <!-- í•˜ë‹¨ ë²„íŠ¼ -->
            <div class="p-4 border-t border-gray-100 bg-white">
                <button onclick="showQuote()" class="w-full bg-gray-900 text-white py-3 rounded-xl font-bold shadow-md active:scale-95 transition">ê²¬ì  ë³´ê¸°</button>
            </div>
        </div>
    </div>

    <script>
        // âš ï¸ [ì¤‘ìš”] ì—¬ê¸°ì— ë³¸ì¸ì˜ Google Apps Script ë°°í¬ URLì„ ë„£ìœ¼ì„¸ìš”!
        const API_URL = "https://script.google.com/macros/s/AKfycbxi95tRe1gGeIdz45pf5kF3xBcb25qA_cEox7W9YDVmuuyKscEdFyT1gR0KQRO4jnq-/exec"; 

        let allData = [], currentDetail = null;

        // ë¡œë”© ì œì–´
        const showLoad = () => document.getElementById('loadingOverlay').classList.remove('hidden');
        const hideLoad = () => document.getElementById('loadingOverlay').classList.add('hidden');

        // ì´ˆê¸° ì‹¤í–‰
        fetch(`${API_URL}?mode=client`).then(r=>r.json()).then(res => {
            allData = res.data;
            filterTrucks('ì „ì²´');
            updateTruckSelect('ì „ì²´');
        }).catch(() => {
            document.getElementById('truckList').innerHTML = '<div class="col-span-2 text-center py-10 text-gray-400">ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ì§€ ëª»í–ˆìŠµë‹ˆë‹¤.</div>';
        });

        // íŠ¸ëŸ­ ë¦¬ìŠ¤íŠ¸ í•„í„°ë§
        function filterTrucks(region) {
            document.getElementById('headerRegion').innerText = region === 'ì „ì²´' ? 'ì „ë¶ ì „ì²´' : region;
            const trucks = allData.filter(d => d.category === 'í‘¸ë“œíŠ¸ëŸ­' && (region === 'ì „ì²´' || d.region.includes(region)));
            
            document.getElementById('truckList').innerHTML = trucks.length ? trucks.map(t => `
                <div onclick='openDetail(${JSON.stringify(t)})' class="bg-white rounded-xl overflow-hidden shadow-sm border border-gray-100 active:scale-95 transition cursor-pointer">
                    <div class="h-32 bg-gray-200"><img src="${t.mainImg}" class="w-full h-full object-cover"></div>
                    <div class="p-3">
                        <span class="text-[10px] text-orange-500 font-bold">${t.region}</span>
                        <h4 class="font-bold text-sm truncate text-gray-900">${t.name}</h4>
                        <p class="text-xs text-gray-400 truncate">${t.menu}</p>
                    </div>
                </div>`).join('') : '<div class="col-span-2 py-10 text-center text-xs text-gray-400">í•´ë‹¹ ì§€ì—­ì— íŠ¸ëŸ­ì´ ì—†ìŠµë‹ˆë‹¤.</div>';
        }

        // ê²¬ì  í¼ì˜ íŠ¸ëŸ­ ì„ íƒë°•ìŠ¤ ì—…ë°ì´íŠ¸
        function updateTruckSelect(region) {
            const select = document.getElementById('qTruck');
            select.innerHTML = '<option value="ìƒê´€ì—†ìŒ">íŠ¸ëŸ­ ìƒê´€ì—†ìŒ (ì¶”ì²œ)</option>';
            allData.filter(d => d.category === 'í‘¸ë“œíŠ¸ëŸ­' && (region==='ì „ì²´' || d.region.includes(region)))
                   .forEach(t => { const opt = document.createElement('option'); opt.value=t.name; opt.innerText=t.name; select.appendChild(opt); });
        }

        // ìƒì„¸ ëª¨ë‹¬ ì—´ê¸°
        function openDetail(d) {
            currentDetail = d;
            document.getElementById('modalImg').src = d.mainImg;
            document.getElementById('detailName').innerText = d.name;
            document.getElementById('detailRegion').innerText = d.region;
            document.getElementById('detailMenu').innerText = d.menu;
            document.getElementById('detailDesc').innerText = d.desc;
            document.getElementById('detailBadge').innerText = d.category;
            document.getElementById('quoteBox').classList.add('hidden');
            
            const subDiv = document.getElementById('subImages');
            subDiv.innerHTML = '';
            if(d.subImages && d.subImages.length > 0) {
                d.subImages.forEach(src => subDiv.innerHTML += `<img src="${src}" class="w-14 h-14 rounded-lg object-cover flex-shrink-0 bg-gray-100 border border-gray-100">`);
            }
            document.getElementById('detailModal').classList.remove('hidden');
        }

        function showQuote() {
            const txt = document.getElementById('quoteText');
            txt.innerText = (currentDetail.basicQuote && currentDetail.basicQuote.trim()) ? currentDetail.basicQuote : "í–‰ì‚¬ë¬¸ì˜ë¥¼ ì£¼ì‹œë©´ ë³„ë„ë¡œ ì•ˆë‚´í•´ ë“œë¦½ë‹ˆë‹¤.";
            const box = document.getElementById('quoteBox');
            box.classList.remove('hidden');
            box.scrollIntoView({behavior:'smooth'});
        }

        // í¼ ì „ì†¡ í•¸ë“¤ëŸ¬
        const handleSubmit = async (e, type) => {
            e.preventDefault();
            showLoad();
            const fd = new FormData(e.target);
            let p = Object.fromEntries(fd.entries());
            
            if(type==='partner') {
                if(p.category==='ì¸ë ¥'){ p.name=document.getElementById('staffName').value; p.owner=document.getElementById('staffAge').value+'ì„¸'; p.age=document.getElementById('staffAge').value; p.dates=document.getElementById('staffDates').value; }
                else { p.name=document.getElementById('truckName').value; p.owner=document.getElementById('truckOwner').value; p.basicQuote=document.getElementById('basicQuote').value; }
                
                p.fileBiz = await toBase64(document.getElementById('fileBiz').files[0]);
                p.fileHealth = await toBase64(document.getElementById('fileHealth').files[0]);
                p.imgMain = await toBase64(document.getElementById('imgMain').files[0]);
            }

            fetch(API_URL, {method:'POST', body:JSON.stringify(p)})
            .then(r=>r.json())
            .then(res => {
                hideLoad();
                if(res.status==='success') {
                    alert(type==='partner'?"âœ… ì‹ ì²­ ì™„ë£Œ!\nê´€ë¦¬ì ìŠ¹ì¸ í›„ ì •ì‹ íŒŒíŠ¸ë„ˆê°€ ë©ë‹ˆë‹¤.":"âœ… ë¬¸ì˜ê°€ ì ‘ìˆ˜ë˜ì—ˆìŠµë‹ˆë‹¤!\në‹´ë‹¹ìê°€ ê³§ ì—°ë½ë“œë¦¬ê² ìŠµë‹ˆë‹¤.");
                    if(type==='partner') location.reload(); else e.target.reset();
                } else { alert("ì˜¤ë¥˜: " + res.msg); }
            })
            .catch(() => { hideLoad(); alert('ì„œë²„ì™€ í†µì‹ í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.'); });
        };

        document.getElementById('quoteForm').onsubmit = (e) => handleSubmit(e, 'quote');
        document.getElementById('partnerForm').onsubmit = (e) => handleSubmit(e, 'partner');

        // íƒ­ ì „í™˜ ë¡œì§
        function switchTab(t) {
            ['home','partner'].forEach(x => document.getElementById(x+'View').classList.add('hidden'));
            document.getElementById(t+'View').classList.remove('hidden');
            
            document.getElementById('tabHome').className = "flex-1 flex flex-col items-center justify-center " + (t==='home'?'text-orange-600':'text-gray-400');
            document.getElementById('tabPartner').className = "flex-1 flex flex-col items-center justify-center " + (t==='partner'?'text-gray-900':'text-gray-400');
            
            window.scrollTo(0,0);
        }

        // í¼ í† ê¸€ (íŠ¸ëŸ­/ì¸ë ¥)
        function toggleForm(type) {
            const isS = type==='staff';
            document.getElementById('fieldTruckOnly').classList.toggle('hidden', isS);
            document.getElementById('fieldStaffOnly').classList.toggle('hidden', !isS);
            document.getElementById('divBiz').classList.toggle('hidden', isS);
            
            document.getElementById('truckName').required = !isS;
            document.getElementById('staffName').required = isS;
            
            document.getElementById('inputMenu').placeholder = isS ? "ê²½ë ¥ / íŠ¹ê¸°" : "ì£¼ìš” ë©”ë‰´";
        }

        // ì§€ì—­ ë²„íŠ¼ ìƒì„±
        const regions = ['ì „ì²´','ì „ì£¼','êµ°ì‚°','ìµì‚°','ì •ì','ë‚¨ì›','ê¹€ì œ','ì™„ì£¼','ì§„ì•ˆ','ë¬´ì£¼','ì¥ìˆ˜','ì„ì‹¤','ìˆœì°½','ê³ ì°½','ë¶€ì•ˆ'];
        document.getElementById('regionGrid').innerHTML = regions.map(r => `<button onclick="filterTrucks('${r}');document.getElementById('regionModal').classList.add('hidden')" class="p-3 bg-gray-100 rounded-xl hover:bg-orange-100 hover:text-orange-600 font-bold">${r}</button>`).join('');
        function openRegionModal(){ document.getElementById('regionModal').classList.remove('hidden'); }

        const toBase64 = file => new Promise(r => { if(!file)r(''); else {const rx=new FileReader(); rx.onload=e=>r(e.target.result); rx.readAsDataURL(file);} });
    </script>
</body>
</html>
